<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8">
  <title>Schedule</title>
  <link rel="stylesheet" href="/css/form-style.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <script th:inline="javascript">
    const groupid = /*[[${groupid}]]*/"groupid";
    console.log(groupid);
    window.onload = function () {
      var sse = new EventSource('/calendar/update?id=' + groupid);
      sse.onmessage = function (event) {
        console.log(event.data);
        var schedule_list = JSON.parse(event.data);
        var schedule_table = "";
        for (var schedule of schedule_list) {
          var bgn_tr = "<tr>";
          var end_tr = "</tr>";
          var date = "<td>" + schedule.hizuke + "</td>";
          var title = "<td>" + schedule.title + "</td>";
          var start_time = "<td>" + schedule.kaisi + "</td>";
          var end_time = "<td>" + schedule.owari + "</td>";
          var detail = "<td>" + "<a href='/detail?id=" + schedule.scheduleid + "'>詳細</a>" + "</td>"
          schedule_table = schedule_table + bgn_tr + date + title + start_time + end_time + detail + end_tr;
        }
        console.log(schedule);
        var tbody = document.getElementById("schedule_list");
        tbody.innerHTML = schedule_table;
      }
    }
  </script>
</head>

<body>
  <div class="header">
    <p class="logo">予定一覧</p>
    <a href="/logout" class="logout-button"><span class="material-icons">logout</span>ログアウト</a>
  </div>
  <div class="wrap">
    <div class="calendar">
      <p><a th:href="@{/post(id=${groupid})}">予定入力</a></p>
      <div class="list">
        <div>
          <span>　　日付　　</span>
          <span>タイトル　</span>
          <span>開始時刻</span>
          <span>終了時刻</span>
        </div>

        <!-- <tbody id="schedule_list"> -->
        <div th:each="group:${groupSchedules}">
          <span th:text="${group.hizuke}"></span>
          <span th:text="${group.title}"></span>
          <span th:text="${group.kaisi}"></span>
          <span th:text="${group.owari}"></span>
          <span><a th:href="@{/detail(id=${group.scheduleid})}">詳細</a></span>
        </div>
        <!-- </tbody> -->
      </div>
    </div>
  </div>
  <a th:href="@{/home}"><span class="material-icons">arrow_back</span>カレンダーに戻る</a>
</body>

</html>
